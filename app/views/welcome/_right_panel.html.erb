<!--  Panel Lote de medicamentos -->
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Lotes de medicamentos <small>Expiración</small></h3>
  </div>
  <div class="panel-body">
    <% data = @medications.group(:status).count.transform_keys { |key| key.split('_').map(&:capitalize).join(' ') }
      status_colors = {"Vigente" => "#40c95e", "Por Vencer" => "#f1ae45", "Vencido" => "#d36262"}
      colors = []
      data.each do |status, _|
        colors << status_colors[status]
      end
      %>
    <%= pie_chart data, colors: colors %>
    Total: <span class="label label-primary"><%= @count_total_medications %></span>
    Vigentes: <span class="label label-success"><%= @count_good_medications %></span>
    Por vencer: <span class="label label-warning"><%= @count_near_expiry_medications %></span>
    Vencidos: <span class="label label-danger"><%= @count_expired_medications %></span>
  </div>
</div>
<!-- Panel Lotes expirados -->
<% if @expired_medications.present? %>
  <div class="panel panel-danger">
    <div class="panel-heading">
      <h3 class="panel-title">Lotes expirados
        <div class="pull-right">
          <%= link_to medications_url(filterrific: {:search_query => 'hola'}), class: 'btn btn-default btn-xs' do %>
                  Ver más
          <% end %>
        </div>
      </h3>
    </div>
    <div class="panel-body body-table">
      <table class="table table-hover table-striped">
        <thead>
          <tr>
            <th>N°Lote</th>
            <th>Droga</th>
            <th>Cantidad</th>
            <th>Expiración</th>
          </tr>
        </thead>
        <tbody>
          <% @expired_medications.each do |em|%>
            <tr>
              <td><%= em.id %></td>
              <td><%= em.name %></td>
              <td><span class="label label-<%= em.quantity_label %>"><%= em.quantity %></span></td>
              <td><%= em.expiry_date.strftime("%d/%m/%y %H:%M") %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
<% end %>

<!-- Panel Lotes próximos a expirar  -->
<% if @near_expiry_medications.present? %>
  <div class="panel panel-warning">
    <div class="panel-heading">
      <h3 class="panel-title">Lotes próximos a expirar</h3>
    </div>
    <div class="panel-body body-table">
      <table class="table table-hover table-striped">
        <thead>
          <tr>
            <th>N°Lote</th>
            <th>Droga</th>
            <th>Cantidad</th>
            <th>Expiración</th>
          </tr>
        </thead>
        <tbody>
          <% @near_expiry_medications.each do |nem|%>
            <tr>
              <td><%= nem.id %></td>
              <td><%= nem.name %></td>
              <td><span class="label label-<%= nem.quantity_label %>"><%= nem.quantity %></span></td>
              <td><%= nem.expiry_date.strftime("%d/%m/%y %H:%M") %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
<% end %>
