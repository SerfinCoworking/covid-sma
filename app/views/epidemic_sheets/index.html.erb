<%= render 'header' %>

<% if @epidemic_sheets.present? %>
  <div class="card fixed-custom-card">
    <div class="card-header">
      <%= form_for_filterrific @filterrific do |f| %>
        <div class="row d-felx justify-content-left">
          <div class="col">
            <!-- Spinner para la carga -->
            <br>
            <%= link_to epidemic_sheets_path(reset: true), class: 'btn btn-secondary',
              title: 'Reiniciar', data: { toggle: 'tooltip', placement: 'top' } do %>
              <%= fa_icon 'redo' %>
            <% end %>
          </div>
          <div class="col">
            <label>Sisa?</label>
            <%= f.select :is_in_sisa, 
              options_for_select(EpidemicSheet.options_for_sisa),{include_blank: false, include_hidden: false},
              {
                class: "form-control selectpicker-md show-tick custom-select-pick",
                "title"=>"Sisa",
              }
            %>
          </div>
          <div class="col-md-2 col-sm-3">
            <label>DNI</label>
            <%= f.text_field(
              :search_dni,
              class: 'filterrific-periodically-observed form-control input-sm'
                ) %>
          </div>
          <div class="col-md-2 col-sm-2">
            <label>Paciente</label>
            <%# give the search field the 'filterrific-periodically-observed' class for live updates %>
            <%= f.text_field(
              :search_fullname,
              class: 'filterrific-periodically-observed form-control input-sm',
              placeholder: 'Nombre o apellido',
              autocomplete: 'off'
            ) %>
          </div>
          <div class="col-md-2">
            <label> Contacto estrecho</label>
            <%= f.text_field(
              :by_close_contact,
              class: 'filterrific-periodically-observed form-control flex-fill',
              placeholder: 'DNI, Nombre o apellido',
              autocomplete: 'off'
            ) %>
          </div>
          <div class="col-md-2 col-sm-2">
            <label>Caso</label>
            <%= f.select :by_case_statuses, 
              options_for_select(CaseStatus.all.collect {|cs| [cs.name, cs.id]}),{include_blank: false, include_hidden: false},
              {
                class: "form-control selectpicker-md show-tick custom-select-pick", 
                multiple: true,
                "title"=>"Caso",
                "data-actions-box"=>true
              }
            %>
          </div>
          <div class="col-md-2 col-sm-2">
            <label>Establecimiento</label>
            <%= f.select :by_establishment, 
              options_for_select(
                Establishment.by_city(current_user.establishment_city).collect {|cs| [cs.name, cs.id]},
                selected: params[:filterrific].present? ? params[:filterrific][:by_establishment] : "",
              ),
              {include_blank: false, include_hidden: false},
              {
                class: "form-control selectpicker-md show-tick custom-select-pick",
                "title"=>"Seleccionar",
                multiple: true,
                "data-live-search"=>true
              }
            %>
          </div>
          <div class="col-md-2 mt-2">
            <label><%= fa_icon 'calendar' %> Desde (FIS)</label>
            <%= f.text_field(:since_date_fis, autocomplete: 'off',
              class: 'datetimepicker form-control since-date',
              placeholder: "Una fecha", data: { date_format: 'DD/MM/YYYY'}) %>
          </div>
          <div class="col-md-2 mt-2">
            <label><%= fa_icon 'calendar' %> Hasta (FIS)</label>
            <%= f.text_field(:to_date_fis, autocomplete: 'off',
              class: 'datetimepicker form-control to-date',
              placeholder: "Una fecha", data: { date_format: 'DD/MM/YYYY'}) %>
          </div>
          <div class="col-md-2 mt-2">
            <label><%= fa_icon 'calendar' %> Desde (Notificación)</label>
            <%= f.text_field(:since_date, autocomplete: 'off',
              class: 'datetimepicker form-control since-date',
              placeholder: "Una fecha", data: { date_format: 'DD/MM/YYYY'}) %>
          </div>
          <div class="col-md-2 mt-2">
            <label><%= fa_icon 'calendar' %> Hasta (Notificación)</label>
            <%= f.text_field(:to_date, autocomplete: 'off',
              class: 'datetimepicker form-control to-date',
              placeholder: "Una fecha", data: { date_format: 'DD/MM/YYYY'}) %>
          </div>
          <div class="col-md-2 mt-2">
            <label>Situación clínica</label>
            <%= f.select :by_clinic_location, 
              options_for_select(
                EpidemicSheet.clinic_locations,
                selected: params[:filterrific].present? ? params[:filterrific][:by_clinic_location] : "",
              ),
              {include_blank: false, include_hidden: false},
              {
                class: "form-control selectpicker-md show-tick custom-select-pick",
                "title"=>"Seleccionar",
                multiple: true,
              }
            %>
          </div>
          <div class="col-md-2 mt-2">
            <label>Ordernar por</label>
            <%= f.select(:sorted_by,
              @filterrific.select_options[:sorted_by],{},
              { class: "selectpicker-md show-tick custom-select-pick", "data-width"=>"100%"}) %>
          </div>
        </div>
      <% end %>
    </div>
    <div class="card-body fixed-panel-index">
      <%= render(
        partial: 'epidemic_sheets/list',
        locals: { epidemic_sheets: @epidemic_sheets }
      ) %>
    </div>
  </div>
<% else %>
<%= render(
  partial: 'shared/not_found',
  locals: { object_name: 'fichas' }
) %>
<% end %>